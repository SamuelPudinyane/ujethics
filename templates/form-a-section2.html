<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>JBS Ethics Form A</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/form_a.css" />
  <style>
    /* Universal style for all checkboxes */
input[type="checkbox"] {
  width: 20px;
  height: 20px;
  border-radius: 50%;          /* Make them round */
  border: 2px solid black;     /* Black border */
  appearance: none;            /* Remove default OS styling */
  -webkit-appearance: none;
  -moz-appearance: none;
  background-color: white;
  cursor: pointer;
  vertical-align: middle;
  position: relative;
}

/* Checked style: black circle with white center */
input[type="checkbox"]:checked {
  background-color: black;
}

/* Inner dot for checked checkboxes */
input[type="checkbox"]:checked::after {
  content: "";
  position: absolute;
  top: 4px;
  left: 4px;
  width: 8px;
  height: 8px;
  background-color: white;
  border-radius: 50%;
}

  </style>

</head>

<body>

  <!-- Navbar -->
  <header class="navbar">
    <div class="nav-content">
      <img src="{{ url_for('static',filename='img/image.png')}}" alt="UJ JBS Logo" class="logo uj">
      <span class="nav-title">Form A – Section 2: Risk Assessment</span>

      <!-- Logout -->
      <div style="text-align: right;">

        <a href="{{url_for('logout')}}" class="btn-logout">Logout</a>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
<form  action="{{url_for('form_a_sec2')}}" method="post" enctype="multipart/form-data">


            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
   
    <h3>1. Ethical Clearance Aspects</h3>
    <table>
      <thead>
        <tr>
          <th>Aspect</th>
          <th>Check all that is applicable:</th>

        </tr>
      </thead>
      <tbody>
        <tr>
          <td>Survey/Questionnaire</td>
          <td><input type="checkbox" value="Yes" name="survey"></td>

        </tr>
        <tr>
          <td>Focus groups</td>
          <td><input type="checkbox" value="Yes" name="focus_groups"></td>

        </tr>
        <tr>
          <td>Observations</td>
          <td><input type="checkbox" value="Yes" name="observations"></td>

        </tr>
        <tr>
          <td>Interviews</td>
          <td><input type="checkbox" value="Yes" name="interviews"></td>

        </tr>
        <tr>
          <td>Documents</td>
          <td><input type="checkbox" value="Yes" name="documents"></td>

        </tr>
        <tr>
          <td>Other</td>
          <td>
            <input type="text" class="form-control d-inline" name="vulnerable_other_specify" placeholder="Specify">
          </td>

        </tr>
      </tbody>
    </table>

    <h3>2. Risk Assessment</h3>
    <table>
      <thead>
        <tr>
          <th>2.1 Does your research include the direct involvement of any of the following groups of participants?</th>
          <th>Tick where applicable</th>

        </tr>
      </thead>
             <tbody>
        <tr>
          <td>a) Communities that may be considered as vulnerable</td>
          <td><input type="checkbox" value="Yes" name="vulnerable_communities"></td>

        </tr>
        <tr>
          <td>b) People under the age of 18 or over 65</td>
          <td><input type="checkbox" value="Yes" name="age_range"></td>

        </tr>
        <tr>
          <td>c) UJ employees or students</td>
          <td><input type="checkbox" value="Yes" name="uj_employees"></td>

        </tr>
        <tr>
          <td>d) Persons not usually considered to be vulnerable but would be considered vulnerable in the context of this
            research project</td>
          <td><input type="checkbox" value="Yes" name="vulnerable"></td>

        </tr>
        <tr>
          <td>e) Non-English-speaking participants</td>
          <td><input type="checkbox" value="Yes" name="non-english"></td>

        </tr>
        <tr>
          <td>f) A researcher’s own students</td>
          <td><input type="checkbox" value="Yes" name="own_students"></td>

        </tr>
        <tr>
          <td>g) People living in poverty</td>
          <td><input type="checkbox" value="Yes" name="poverty"></td>

        </tr>
        <tr>
          <td>h) People with little or no education </td>
          <td><input type="checkbox" value="Yes" name="no_education"></td>

        </tr>
        <tr>
          <td>i) Other: Provide a description</td>
          <td><input type="text" class="form-control d-inline" name="assessment_other_specify" placeholder="Specify">
          </td>

        </tr>
      </tbody>
    </table>
    
    <hr>

    <table>
      <thead>
        <tr>
          <th>2.2 Does your research involve any of the following types of activity?</th>
          <th>Tick where applicable</th>

        </tr>
      </thead>
      <tbody>
        <tr>
          <td>a) Collection, use or disclosure of information WITHOUT the consent of the individual whose information it
            is, with the exception of aggregated data or data from official databases such as StatsSA, SARS, etc.</td>
          <td><input type="checkbox" value="Yes" name="disclosure"></td>

        </tr>
        <tr>
          <td>b) Causing discomfiture to participants beyond normal levels of inconvenience</td>
          <td><input type="checkbox" value="Yes" name="discomfiture"></td>

        </tr>
        <tr>
          <td>c) Deception of participants, concealment or covert observation</td>
          <td><input type="checkbox" value="Yes" name="deception"></td>

        </tr>
        <tr>
          <td>d) Examining potentially sensitive or contentious issues</td>
          <td><input type="checkbox" value="Yes" name="sensitive"></td>

        </tr>
        <tr>
          <td>e) Seeking disclosure of information which may be prejudicial to participants</td>
          <td><input type="checkbox" value="Yes" name="prejudice"></td>

        </tr>
        <tr>
          <td>f) Using intrusive techniques</td>
          <td><input type="checkbox" value="Yes" name="intrusive_techniques"></td>

        </tr>
        <tr>
          <td>g) Study of or participation in illegal activities</td>
          <td><input type="checkbox" value="Yes" name="illegal_activities"></td>

        </tr>
        <tr>
          <td>h) Personal and social information collected directly from participants</td>
          <td><input type="checkbox" value="Yes" name="personal"></td>

        </tr>
        <tr>
          <td>i)Identifiable information to be collected about people from available records (e.g., staff records, student
            records, etc.)</td>
          <td><input type="checkbox" value="Yes" name="available_records"></td>

        </tr>
        <tr>
          <td>j) Psychology inventories / scales / tests</td>
          <td><input type="checkbox" value="Yes" name="inventories"></td>

        </tr>
        <tr>
          <td>k) Activities which may place the researcher(s) / data collector at risk</td>
          <td><input type="checkbox" value="Yes" name="risk_activities"></td>

        </tr>
        <tr>
          <td>l) Other: Provide a description</td>
          <td><input type="text" class="form-control d-inline" name="activity_specify" placeholder="Specify"></td>

        </tr>

      </tbody>
    </table>
    <label for="vulnerable_comments">Comments</label>
    <textarea name="vulnerable_comments" rows="3" placeholder="Comments (if any)..."></textarea>
    <hr>

    <table>
      <thead>
        <tr>
          <th>2.3 Do any of the following apply to your research project?</th>
          <th>Tick where applicable</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>a) Reimbursement or incentives to any participants. </td>
          <td><input type="checkbox" name="Yes" name="incentives"></td>

        </tr>
        <tr>
          <td>b) The participants will incur financial costs by participating in the study.</td>
          <td><input type="checkbox" value="Yes" name="financial_costs"></td>

        </tr>
        <tr>
          <td>c) At least one of the researchers has a financial or other involvement in the research (apart from their
            research role) or may receive a reward.</td>
          <td><input type="checkbox" value="Yes" name="reward"></td>

        </tr>
        <tr>
          <td>d) Any other potential conflict of interest for any of the researchers (real or perceived financial or
            personal considerations that may compromise a researcher’s professional judgement in carrying out or
            reporting research, such as conducting research with colleagues, peers or students).</td>
          <td><input type="checkbox" value="Yes" name="conflict"></td>

        </tr>
        <tr>
          <td>e) Research is done on the premises of UJ or any of its units.</td>
          <td><input type="checkbox" value="Yes" name="uj_premises"></td>

        </tr>
        <tr>
          <td>f) Research will make use of some of UJs facilities (venues, software, hardware, etc.)</td>
          <td><input type="checkbox" value="Yes" name="uj_facilities"></td>

        </tr>
        <tr>
          <td>g) Research will be funded by UJ or funding for it was acquired through UJ.</td>
          <td><input type="checkbox" value="Yes" name="uj_funding"></td>

        </tr>
        <tr>
          <td>h) Other (Specify)</td>
          <td><input type="text" name="vulnerable_comments_3" placeholder="Specify"></td>
        </tr>
      </tbody>
    </table>

    <label for="apply_comments">Comments</label>

    <textarea name="apply_comments" rows="3" placeholder="Comments (if any)..."></textarea>
    <br>
  <div class="mb-3">
                        <label><strong>2.4 Rate your project (Low, Medium, High Risk):</strong>
                          <span class="info-icon" title="Low risk: ; Medium risk: ' High risk:">ℹ</span>
                        </label>
                        <select name="risk_rating" id="risk-rating" class="form-select" onchange="toggleRiskFields()">
                          <option value="">-- Select Risk Level --</option>
                          <option value="low">Low</option>
                          <option value="medium">Medium</option>
                          <option value="high">High</option>
                        </select>
                          <label for="risk_justification">2.4.1 Please justify your risk level</label>
                          <input type="text" name="risk_justification" required placeholder="Justification for risk level">
                        <div id="risk-fields">
                          

                          <label for="benefits_description">2.4.2 For medium and high risk, describe the potential benefits of the study:</label>
                          <input type="text" name="benefits_description" placeholder="Describe potential benefits">

                          <label for="risk_mitigation">2.4.3 For medium and high risk, describe how potential risks will be mitigated against:</label>
                          <input type="text" name="risk_mitigation" placeholder="Describe risk mitigation strategies">
                        </div>
                      </div>


    <!-- Navigation Buttons -->
    <div class="form-navigation">
      <a href="{{url_for('form_a_sec1')}}" class="revise-btn">⬅ Section 1</a>
      <button type="submit" class="approve-btn">Next ➔ Section 3</button>
    </div>
    </form>

  </main>

  <!-- Footer -->
 <footer class="footer">
   
</footer>

  <script>

    document.getElementById("formAsection2").addEventListener("submit", async function (event) {
      event.preventDefault();

      const form = event.target;
      const formData = new FormData(form); // Collects all text and file fields

      const response = await fetch('{{ url_for("submit_form_a_sec2") }}', {
        method: 'POST',
        body: formData //browser sets Headers automatically!
      });

      if (response.ok) {
        window.location.href = '{{ url_for("form_a_sec3") }}';
      }
      const result = await response.json();
      document.getElementById("message").textContent = result.message;
    });

function toggleRiskFields() {
    const riskLevel = document.getElementById("risk-rating").value;
    const riskFields = document.getElementById("risk-fields");
if (riskLevel) {
    if (riskLevel === "low") {
      riskFields.style.display = "none";
      // Optionally clear input values if needed
      riskFields.querySelectorAll("input").forEach(input => input.value = "");
    } else {
      riskFields.style.display = "block";
    }
  }
}

  // Run on page load in case of default value
  window.onload = toggleRiskFields;
  </script>

</body>

</html>