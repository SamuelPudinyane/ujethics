<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Form B – Researcher's Details | JBS Ethics</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/css/form_a.css" />
  <!-- <link rel="stylesheet" href="{{ url_for('static', filename='css/form_a.css') }}"> -->

  <style>
        .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: #fff;
      padding: 2rem;
      border-radius: 8px;
      text-align: center;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 0 10px rgba(0,0,0,0.25);
    }

    .modal-content h3 {
      margin-bottom: 1rem;
      color: #2E1A46;
    }

    .modal-content button {
      margin-top: 1rem;
      background-color: #2E1A46;
      color: #fff;
      padding: 0.6rem 1.2rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    span{
        font-weight: normal;
        font-size:14px;
    }
     .dropdown-checkboxes {
      max-height: 200px;
      overflow-y: auto;
    }
</style>
</head>

<body>

  <!-- Navbar -->
  <header class="navbar">
    <div class="nav-content">
      <img src="{{ url_for('static',filename='img/image.png')}}" alt="UJ JBS Logo" class="logo uj">
      <span class="nav-title">Form B – Researcher's Details</span>

      <!-- Logout -->
      <div style="text-align: right;">
        <a href="{{url_for('logout')}}" class="btn-logout">Logout</a>
      </div>
    </div>
  </header>
<form action="{{url_for('ethics_reviewer_committee_forms',id=formB.form_id,form_name='FORM B')}}" method="post"  enctype="multipart/form-data">
  <!-- Error Messages -->
            {% if messages %}
                <div id="alertMessage" class="alert alert-danger alert-dismissible fade show">
                    {% for message in messages %}
                        {{ message }}
                    {% endfor %}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endif %}

            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <!-- Main Content -->
    <main class="main-content">
      <h2>Researcher's Details</h2>
      <label>Applicant Name <br>
        <span class="form-answer">{{formB.applicant_name}}</span>
    </label>
      <label>Student/Staff Number <br>
        <span class="form-answer">{{formB.student_number}}</span></label>
      <label>Institution <br>
        <span class="form-answer">{{formB.institution}}</span></label>
      <label>UJ Department and School <br>
        <span class="form-answer">{{formB.department}}</span></label>
      <label>Degree Registered For <br>
        <span class="form-answer">{{formB.dregree}}</span></label>
      <label>Title/Working Title of Project or Study <br>
        <span class="form-answer">{{formB.study_title}}</span></label>
      <label>Mobile Number <br>
        <span class="form-answer">{{formB.mobile}}</span></label>
      <label>Email Address <br>
        <span class="form-answer">{{formB.email}}</span></label>
      <label>Supervisor(s) <br>
        <span class="form-answer">{{formB.supervisor}}</span></label>
      <label>Supervisor Email Address <br>
        <span class="form-answer">{{formB.supervisor_email}}</span></label>
   

    
  </main>

  <!-- Section 2 -->

  
    <!-- Main Content -->
    <main class="main-content">

      <h2>Research Project and Data Information</h2>

      <label>1. Short Description of the Research Project (±200 words)
        <br>
        <span class="form-answer">{{formB.project_description}}</span>
      </label>


      <hr>

      <h3>2. Details of the Data</h3>

      <label>2.1 Nature of the Data <br>
    <span class="form-answer">{{formB.data_nature}}</span>
</label>
 

      <label>2.2 Origin/Source of Research Data
        <br><span class="form-answer">{{formB.data_origin}}</span>
      </label>
 

      <div class="question-block">
        <label>2.3 Are the sources of the research data in the public domain?
            <br><span class="form-answer">{{'Yes' if formB.data_public else 'No'}}</span>
        </label>
        
      </div>

      <label>Provide evidence or explanation (if applicable)
        <br><span class="form-answer">{{formB.public_evidence}}</span>
      </label>
   

      <label>2.4 If data is not public, what are the access conditions?
        <br><span class="form-answer">{{formB.access_conditions}}</span>
      </label>
    

      <div class="question-block">
        <label>2.5 Does the database contain personal information/identifiers?
            <br><span class="form-answer">{{'Yes' if formB.data_public else 'No'}}</span>
        </label>
        
      
      </div>

      <div class="question-block">
        <label>2.6 If yes, has the data been anonymized?
            <br><span class="form-answer">{{formB.data_anonymized}}</span>
        </label>
       
      </div>

      <label>Comment / Justification:<br>
    <span class="form-answer">{{formB.anonymization_comment}}</span></label>

     
      <div class="question-block">
        <label>2.7 Private database: does it contain confidential private company data requiring permission?
            <br><span class="form-answer">{{'Yes' if formB.private_permission else 'No'}}<span class="form-answer">
        </label>
      </div>

      <label>Provide permission details (or attach separately):
        <br><span class="form-answer">{{formB.permission_details}}</span>
      </label>
     

      <div class="question-block">
        <label>2.8 Will data shortcomings/incompleteness be reported?
            <br><span class="form-answer">{{'Yes' if formB.shortcommings_report else 'No'}}</span>
        </label>
       
      </div>

      <label>2.9 How will data limitations be reported?
        <br><span class="form-answer">{{formB.limitations_reporting}}</span>
      </label>
    

      <div class="question-block">
        <label>2.10 Are the research methodology and design aligned with secondary data use?
            <br><span class="form-answer">{{'Yes' if formB.methodology_alighnment else 'No'}}</span>
        </label>
       
      </div>

      <label>2.11 How will original owners of the data be acknowledged?
        <br><span class="form-answer">{{formB.data_acknowledgment}}</span>
      </label>
    
   
  </main>

  <!-- Section 3 -->

   <!-- Main Content -->
  <main class="main-content">
    
      <h2>Ethical Considerations</h2>

      <div class="question-block" >
        <label>3.1 Was ethical clearance granted for the original data gathering phase?
            <br><span class="form-answer">{{formB.original_clearance}}</span>
        </label>
        
      </div>

      <div class="question-block">
        <label>3.2 Did participants in the original study grant permission for future use of the data?
            <br><span class="form-answer">{{formB.participant_permission}}</span>
        </label>
       
      </div>

      <label>3.3 If the data is not in the public domain, explain how it will be safely stored and destroyed:
        <br><span class="form-answer">{{formB.data_safekeeping}}</span>
      </label>
 

      <hr>

      <h2>Risk Assessment</h2>

      <div class="question-block">
        <label>The study presents:
            <br><span class="form-answer">{{formB.risk_level}}</span>
        </label>
        
      </div>

      <label>Comments:
        <br><span class="form-answer">{{formB.risk_comments}}</span>
      </label>
    

      <hr>

      <h2>Declaration</h2>

      <p class="form-note">
        I, <strong>{{formB.declaration_name}}</strong>
        (full name of main researcher), declare that I have read the Policy on Research Ethics of UJ and the contents of this document are a true and accurate reflection of the methodological and ethical implications of my proposed study. I shall carry out the study in strict accordance with the approved proposal and the Policy on Research Ethics of UJ. I further undertake to inform the relevant research ethics review committee of JBS in writing of any adverse events that occur arising from the research project. I shall also notify the relevant JBS research ethics review committee if any changes to the study are proposed. I shall deal with the data used in an ethical manner. I shall assimilate all data used for this research project in accordance with ethical guidelines outlined in my proposal. Paragraph 5 of the Policy on Research Ethics places huge emphasis on the integrity of the research and I shall ensure that I conduct the research with the highest integrity taking into account UJ’s Policy for Copyright Infringement and Plagiarism. Data that was gathered retrospectively will not be used. I acknowledge that as main researcher it is my responsibility to ensure that the co-researchers to this research project adhere to the ethics principles set out in the UJ Policy on Research Ethics. 
      </p>

      <label>Full Name
        <br><strong>{{formB.full_name}}</strong>
      </label>

      <label>Date
        <br><span class="form-answer">{% if formB.declaration_date%}{{formB.declaration_date}}{% endif%}</span>
      </label>

      <hr>
   
       
      <div id="supervisorDeclaration" >
    
      <h1>JOHANNESBURG BUSINESS SCHOOL<br>RESEARCH ETHICS COMMITTEE<br>REVIEWER REPORT</h1>

  <div class="section">
    <label>Student Name:</label>
    <span class="form-answer">{{formB.declaration_name}}</span>

    <label>Date of Submission:</label>
    <span class="form-answer">{% if formB.submitted_at%}{{formB.submitted_at.strftime('%d/%m/%Y')}}{% endif%}</span>

    <label>Date of Re-submission:</label>
    <span class="form-answer">{% if formB.declaration_date%}{{formB.declaration_date.strftime('%d/%m/%Y')}}{% endif%}</span>

    <label>Supervisor:</label>
    <span class="form-answer">{{formB.supervisor}}</span>

    <label>Title of Research:</label>
    <span class="form-answer">{{formB.study_title}}</span>

    <label>Date of Review:</label>
    <input type="date" name="review_date">
  </div>

  <br>

  <div class="section">
    <h3>Comments</h3>
    <textarea name="additional_comments"></textarea>
  </div>

  <!-- Radio Buttons -->
  <div class="form-check">
    <input class="form-check-input" type="radio" name="recommendation" id="ready" value="Ready for submission" onchange="toggleFields()" required>
    <label class="form-check-label" for="ready">
      ✔ Ready for submission to Reviewers
    </label>
  </div>

  <div class="form-check mb-3">
    <input class="form-check-input" type="radio" name="recommendation" id="revisions" value="Revisions required" onchange="toggleFields()">
    <label class="form-check-label" for="revisions">
     ↻ Revisions required before submission
    </label>
  </div>

  <!-- Accept Fields (initially hidden) -->
  <div id="acceptFields" style="display: none;">
   
    <label>Reviewer(s):</label>
  <div class="dropdown">
    <button class="btn btn-outline-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
      Select Reviewers
    </button>
    <ul class="dropdown-menu dropdown-checkboxes p-2" aria-labelledby="dropdownMenuButton">
      {% for item in formReviewers %}
      <li><label class="form-check"><input class="form-check-input" type="checkbox" name="reviewer_names[]" value="{{item.user_id}}"> {{item.full_name}}</label></li>
      {% endfor %}
    </ul>
  </div>


    <div class="form-group">
      <label for="supervisor_signature">Ethics Admin Signature:</label>
      <input type="text" class="form-control" id="supervisor_signature" name="supervisor_signature">
    </div>

    <div class="form-group">
      <label for="signature_date">Date:</label>
      <input type="date" class="form-control" id="signature_date" name="signature_date">
    </div>
 
    <button type="submit" name="accept" value="Accept" class="btn btn-success">Submit</button>
  </div>

  <!-- Reject Button (initially hidden) -->
  <div id="rejectBtn" style="display: none;">
    <div class="submit-row" id="rejectBtn" style="display: none;">
  <label for="statusReject">Select Rejection Status:</label>
  <select id="statusReject" name="status" class="form-select" >
    <option value="">-- Choose --</option>
    <option value="Resubmission Required">↻ Resubmission Required</option>
    <option value="Reject">✖ Reject</option>
  </select>
  <br>
</div>
    <button type="submit" name="reject" value="Reject" class="btn btn-danger">Submit back to Student (Requires Submission)</button>
  </div>

</form>
  </main>



<!-- Confirmation Modal -->
<div id="confirmationModal" class="modal-overlay">
  <div class="modal-content">
    <h3>Form B Submitted Successfully!</h3>
    <p>Your application has been received and forwarded to your supervisor.</p>
    <button onclick="window.location.href='dashboard.html'">Go to Dashboard</button>
  </div>
</div>


  <footer class="footer">
    <p>&copy; 2025 Johannesburg Business School | University of Johannesburg</p>
  </footer>

  
<!-- Script -->
<script>
  document.getElementById('formBFinal').addEventListener('submit', function (e) {
    e.preventDefault();
    document.getElementById('confirmationModal').style.display = 'flex';
  });

    const supervisorDeclaration = document.getElementById("supervisorDeclaration");
  const submitToEthicsBtn = document.getElementById("submitToEthics");
  const submitToStudentBtn = document.getElementById("submitToStudent");

  // Show declaration when "Submit for Ethics Approval" is clicked
  submitToEthicsBtn.addEventListener("click", () => {
    supervisorDeclaration.style.display = "block";
  });

  // Hide declaration when "Return to Student" is clicked
  submitToStudentBtn.addEventListener("click", () => {
    supervisorDeclaration.style.display = "none";
  });

  // Simulate submission
  form.addEventListener("submit", function (e) {
    e.preventDefault();
    modal.style.display = "flex";
  });

  closeModalBtn.addEventListener("click", () => {
    window.location.href = "supervisor-dashboard.html";
  });

function toggleFields() {
  const ready = document.getElementById("ready").checked;
  const revisions = document.getElementById("revisions").checked;

  const acceptFields = document.getElementById("acceptFields");
  const rejectBtn = document.getElementById("rejectBtn");

  const signature = document.getElementById("supervisor_signature");
  const date = document.getElementById("signature_date");

  if (ready) {
    acceptFields.style.display = "block";
    rejectBtn.style.display = "none";
    signature.required = true;
    date.required = true;
  } else if (revisions) {
    acceptFields.style.display = "none";
    rejectBtn.style.display = "block";
    signature.required = false;
    date.required = false;
    signature.value = '';
    date.value = '';
  } else {
    acceptFields.style.display = "none";
    rejectBtn.style.display = "none";
  }
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
